/*
 * @license
 * chartjs-plugin-crosshair
 * http://abelheinsbroek.nl/
 * Version: 1.1.1
 *
 * Copyright 2019 Abel Heinsbroek
 * Released under the MIT license
 * https://github.com/abelheinsbroek/chartjs-plugin-crosshair/blob/master/LICENSE.md
 */
!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],a):a(t.Chart)}(this,(function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var a;(a=t).Interaction.modes.interpolate=function(t,e,s){for(var o=[],i=0;i<t.data.datasets.length;i++)if(t.data.datasets[i].interpolate){var r=t.getDatasetMeta(i);if(!r.hidden){var n=t.scales[r.xAxisID],l=t.scales[r.yAxisID],c=n.getValueForPixel(e.x),d=t.data.datasets[i].data,h=d.findIndex((function(t){return t.x>=c}));if(-1!==h){var x=d[h-1],u=d[h];if(x&&u)var g=(u.y-x.y)/(u.x-x.x),p=x.y+(c-x.x)*g;if(t.data.datasets[i].steppedLine&&x&&(p=x.y),!isNaN(p)){var m=l.getPixelForValue(p);if(!isNaN(m)){var v={value:p,xValue:c,tooltipPosition:function(){return this._model},hasValue:function(){return!0},_model:{x:e.x,y:m},_datasetIndex:i,_index:o.length,_xScale:{getLabelForIndex:function(t){return o[t].xValue}},_yScale:{getLabelForIndex:function(t){return o[t].value}}};o.push(v)}}}}}var f=a.Interaction.modes.x(t,e,s);for(h=0;h<f.length;h++){var y=f[h];t.data.datasets[y._datasetIndex].interpolate||o.push(y)}return o},function(t){var a=t.helpers,e={line:{color:"#F66",width:1},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},callbacks:{beforeZoom:function(t,a){return!0},afterZoom:function(t,a){}}},s={id:"crosshair",afterInit:function(t){void 0===t.options.plugins.crosshair&&(t.options.plugins.crosshair=e),t.crosshair={enabled:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,reset:function(){this.resetZoom(t,!1,!1)}.bind(this)},this.getOption(t,"sync","enabled")&&(t.crosshair.syncEventHandler=function(a){this.handleSyncEvent(t,a)}.bind(this),t.crosshair.resetZoomEventHandler=function(a){var e=this.getOption(t,"sync","group");a.chartId!==t.id&&a.syncGroup===e&&this.resetZoom(t,!0)}.bind(this),window.addEventListener("sync-event",t.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler)),t.panZoom=this.panZoom.bind(this,t)},destroy:function(t){this.getOption(t,"sync","enabled")&&(window.removeEventListener("sync-event",t.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler))},panZoom:function(t,a){if(0!==t.crosshair.originalData.length){var e=t.crosshair.end-t.crosshair.start,s=t.crosshair.min,o=t.crosshair.max;a<0?(t.crosshair.start=Math.max(t.crosshair.start+a,s),t.crosshair.end=t.crosshair.start===s?s+e:t.crosshair.end+a):(t.crosshair.end=Math.min(t.crosshair.end+a,t.crosshair.max),t.crosshair.start=t.crosshair.end===o?o-e:t.crosshair.start+a),this.doZoom(t,t.crosshair.start,t.crosshair.end)}},getOption:function(t,s,o){return a.getValueOrDefault(t.options.plugins.crosshair[s]?t.options.plugins.crosshair[s][o]:void 0,e[s][o])},getXScale:function(t){return t.data.datasets.length?t.scales[t.getDatasetMeta(0).xAxisID]:null},getYScale:function(t){return t.scales[t.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(t,a){var e=this.getOption(t,"sync","group");if(a.chartId!==t.id&&a.syncGroup===e){var s=this.getXScale(t);if(s){var o=void 0===a.original.native.buttons?a.original.native.which:a.original.native.buttons;"mouseup"===a.original.type&&(o=0);var i={type:a.original.type,chart:t,x:s.getPixelForValue(a.xValue),y:a.original.y,native:{buttons:o},stop:!0};t.controller.eventHandler(i)}}},afterEvent:function(t,a){var e=this.getXScale(t);if(e){var s=void 0===a.native.buttons?a.native.which:a.native.buttons;"mouseup"===a.native.type&&(s=0);var o=this.getOption(t,"sync","enabled"),i=this.getOption(t,"sync","group");if(!a.stop&&o){var r=new CustomEvent("sync-event");r.chartId=t.id,r.syncGroup=i,r.original=a,r.xValue=e.getValueForPixel(a.x),window.dispatchEvent(r)}var n=this.getOption(t,"sync","suppressTooltips");if(t.crosshair.suppressTooltips=a.stop&&n,t.crosshair.enabled="mouseout"!==a.type&&a.x>e.getPixelForValue(e.min)&&a.x<e.getPixelForValue(e.max),!t.crosshair.enabled)return a.x>e.getPixelForValue(e.max)&&t.update(),!0;var l=this.getOption(t,"zoom","enabled");if(1===s&&!t.crosshair.dragStarted&&l&&(t.crosshair.dragStartX=a.x,t.crosshair.dragStarted=!0),t.crosshair.dragStarted&&0===s){t.crosshair.dragStarted=!1;var c=e.getValueForPixel(t.crosshair.dragStartX),d=e.getValueForPixel(t.crosshair.x);Math.abs(t.crosshair.dragStartX-t.crosshair.x)>1&&this.doZoom(t,c,d),t.update()}t.crosshair.x=a.x,t.draw()}},afterDraw:function(t){if(t.crosshair.enabled)return t.crosshair.dragStarted?this.drawZoombox(t):(this.drawTraceLine(t),this.interpolateValues(t),this.drawTracePoints(t)),!0},beforeTooltipDraw:function(t){return!t.crosshair.dragStarted&&!t.crosshair.suppressTooltips},resetZoom:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e){for(var s=0;s<t.data.datasets.length;s++){var o=t.data.datasets[s];o.data=t.crosshair.originalData.shift(0)}var i="ticks";t.options.scales.xAxes[0].time&&(i="time"),t.crosshair.originalXRange.min?(t.options.scales.xAxes[0][i].min=t.crosshair.originalXRange.min,t.crosshair.originalXRange.min=null):delete t.options.scales.xAxes[0][i].min,t.crosshair.originalXRange.max?(t.options.scales.xAxes[0][i].max=t.crosshair.originalXRange.max,t.crosshair.originalXRange.max=null):delete t.options.scales.xAxes[0][i].max}t.crosshair.button&&t.crosshair.button.parentNode&&(t.crosshair.button.parentNode.removeChild(t.crosshair.button),t.crosshair.button=!1);var r=this.getOption(t,"sync","enabled");if(!a&&e&&r){var n=this.getOption(t,"sync","group"),l=new CustomEvent("reset-zoom-event");l.chartId=t.id,l.syncGroup=n,window.dispatchEvent(l)}if(e){var c=t.options.animation;t.options.animation=!1,t.update(),t.options.animation=c}},doZoom:function(t,s,o){if(s>o){var i=s;s=o,o=i}if(!a.getValueOrDefault(t.options.plugins.crosshair.callbacks?t.options.plugins.crosshair.callbacks.beforeZoom:void 0,e.callbacks.beforeZoom)(s,o))return!1;if("time"===t.options.scales.xAxes[0].type?(t.options.scales.xAxes[0].time.min&&0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.min=t.options.scales.xAxes[0].time.min),t.options.scales.xAxes[0].time.max&&0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.max=t.options.scales.xAxes[0].time.max)):(t.options.scales.xAxes[0].ticks.min&&void 0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.min=t.options.scales.xAxes[0].ticks.min),t.options.scales.xAxes[0].ticks.max&&void 0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.max=t.options.scales.xAxes[0].ticks.max)),!t.crosshair.button){var r=document.createElement("button"),n=this.getOption(t,"zoom","zoomButtonText"),l=this.getOption(t,"zoom","zoomButtonClass"),c=document.createTextNode(n);r.appendChild(c),r.className=l,r.addEventListener("click",function(){this.resetZoom(t)}.bind(this)),t.canvas.parentNode.appendChild(r),t.crosshair.button=r}t.options.scales.xAxes[0].time?(t.options.scales.xAxes[0].time.min=s,t.options.scales.xAxes[0].time.max=o):(t.options.scales.xAxes[0].ticks.min=s,t.options.scales.xAxes[0].ticks.max=o);for(var d=0===t.crosshair.originalData.length,h=0;h<t.data.datasets.length;h++){var x=[],u=0,g=!1,p=!1;d&&(t.crosshair.originalData[h]=t.data.datasets[h].data);for(var m=t.crosshair.originalData[h],v=0;v<m.length;v++){var f=m[v];f.t>=s&&!g&&u>0&&(x.push(m[u-1]),g=!0),f.t>=s&&f.t<=o&&x.push(f),f.t>o&&!p&&u<m.length&&(x.push(f),p=!0),u+=1}t.data.datasets[h].data=x}if(t.crosshair.start=s,t.crosshair.end=o,d){var y=this.getXScale(t);t.crosshair.min=y.min,t.crosshair.max=y.max}t.update(),this.getOption(t,"callbacks","afterZoom")(s,o)},drawZoombox:function(t){var a=this.getYScale(t),e=this.getOption(t,"zoom","zoomboxBorderColor"),s=this.getOption(t,"zoom","zoomboxBackgroundColor");t.ctx.beginPath(),t.ctx.rect(t.crosshair.dragStartX,a.getPixelForValue(a.max),t.crosshair.x-t.crosshair.dragStartX,a.getPixelForValue(a.min)-a.getPixelForValue(a.max)),t.ctx.lineWidth=1,t.ctx.strokeStyle=e,t.ctx.fillStyle=s,t.ctx.fill(),t.ctx.fillStyle="",t.ctx.stroke(),t.ctx.closePath()},drawTraceLine:function(t){var a=this.getYScale(t),e=this.getOption(t,"line","width"),s=this.getOption(t,"line","color");t.ctx.beginPath(),t.ctx.moveTo(t.crosshair.x,a.getPixelForValue(a.max)),t.ctx.lineWidth=e,t.ctx.strokeStyle=s,t.ctx.lineTo(t.crosshair.x,a.getPixelForValue(a.min)),t.ctx.stroke()},drawTracePoints:function(t){for(var a=0;a<t.data.datasets.length;a++){var e=t.data.datasets[a],s=t.getDatasetMeta(a),o=t.scales[s.yAxisID];!s.hidden&&e.interpolate&&(t.ctx.beginPath(),t.ctx.arc(t.crosshair.x,o.getPixelForValue(e.interpolatedValue),3,0,2*Math.PI,!1),t.ctx.fillStyle="white",t.ctx.lineWidth=2,t.ctx.strokeStyle=e.borderColor,t.ctx.fill(),t.ctx.stroke())}},interpolateValues:function(t){for(var a=0;a<t.data.datasets.length;a++){var e=t.data.datasets[a],s=t.getDatasetMeta(a),o=t.scales[s.xAxisID].getValueForPixel(t.crosshair.x);if(!s.hidden&&e.interpolate){var i=e.data,r=i.findIndex((function(t){return t.x>=o})),n=i[r-1],l=i[r];if(t.data.datasets[a].steppedLine&&n)e.interpolatedValue=n.y;else if(n&&l){var c=(l.y-n.y)/(l.x-n.x);e.interpolatedValue=n.y+(o-n.x)*c}else e.interpolatedValue=NaN}}}};t.plugins.register(s)}(t)}));