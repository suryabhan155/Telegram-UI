class DatatableExtend{get options(){return{datatable:null,editRowCallback:null,singleSelectCallback:null,anySelectCallback:null,noneSelectCallback:null,multipleSelectCallback:null,lengthChangeCallback:null}}constructor(t={}){this.settings=Object.assign(this.options,t),this.datatable=this.settings.datatable,this.datatable&&(this.element=this.datatable.table().container()),this._init()}_init(){this._addListeners(),this._addShortcuts()}_addListeners(){document.getElementById("datatableCheckAll")&&document.getElementById("datatableCheckAll").addEventListener("change",this._onCheckAllChange.bind(this)),document.getElementById("datatableCheckAllButton")&&document.getElementById("datatableCheckAllButton").addEventListener("click",this._onCheckAllButtonClick.bind(this)),this.element&&this.element.querySelectorAll("tbody").forEach((t=>t.addEventListener("click",this._onRowClick.bind(this)))),document.querySelectorAll(".datatable-search").forEach((t=>{t.addEventListener("keyup",this._onSearchKeyup.bind(this))})),document.querySelectorAll(".search-delete-icon").forEach((t=>{t.addEventListener("click",this._onSearchDelete.bind(this))})),document.querySelectorAll(".datatable-export .dropdown-item").forEach((t=>{t.addEventListener("click",this._onExportClick.bind(this))})),document.querySelectorAll(".datatable-print").forEach((t=>{t.addEventListener("click",this._onPrintClick.bind(this))})),document.querySelectorAll(".datatable-length .dropdown-item").forEach((t=>{t.addEventListener("click",this._onLengthClick.bind(this))}))}_addShortcuts(){"undefined"!=typeof Mousetrap&&(Mousetrap.bind("mod+a",(t=>{t.preventDefault(),this.datatable.data().any()&&(this.checkAllRows(),this.controlCheckAll())})),Mousetrap.bind("mod+d",(t=>{t.preventDefault(),this.datatable.data().any()&&(this.unCheckAllRows(),this.controlCheckAll())})))}_onRowClick(t){if(t.preventDefault(),!this.datatable.data().any())return;const e=t.target.closest("tr");if("A"===t.target.tagName)return this.unCheckAllRows(),this.settings.editRowCallback(this.datatable.row(e)),!0;e.classList.toggle("selected");const l=e.querySelector(".form-check input");l.checked=!l.checked,l.dispatchEvent(new Event("change")),this.controlCheckAll()}_onCheckAllChange(t){document.getElementById("datatableCheckAll").checked?this.checkAllRows():this.unCheckAllRows(),this.controlCheckAll()}_onCheckAllButtonClick(t){if(!this.datatable.data().any())return;const e=t.target,l=t.currentTarget;e.classList.contains("form-check-input")||l.querySelector("input").click()}controlCheckAll(){if(!document.getElementById("datatableCheckAll"))return;let t=!1,e=!0;this.element.querySelectorAll("tbody tr .form-check input").forEach((l=>{l.checked?t=!0:e=!1})),this.datatable&&!this.datatable.data().any()&&(e=!1,t=!1),t?(document.getElementById("datatableCheckAll").indeterminate=t,this.settings.anySelectCallback&&this.settings.anySelectCallback()):(document.getElementById("datatableCheckAll").indeterminate=t,document.getElementById("datatableCheckAll").checked=t,this.settings.noneSelectCallback&&this.settings.noneSelectCallback()),e&&(document.getElementById("datatableCheckAll").indeterminate=!1,document.getElementById("datatableCheckAll").checked=e),1===this.element.querySelectorAll("tbody tr .form-check input:checked").length?this.settings.singleSelectCallback&&this.settings.singleSelectCallback():this.settings.multipleSelectCallback&&this.settings.multipleSelectCallback()}unCheckAllRows(){this.element&&(this.element.querySelectorAll("tbody tr").forEach((t=>t.classList.remove("selected"))),this.element.querySelectorAll("tbody tr .form-check input").forEach((t=>{t.checked=!1})))}checkAllRows(){this.element&&(this.element.querySelectorAll("tbody tr").forEach((t=>t.classList.add("selected"))),this.element.querySelectorAll("tbody tr .form-check input").forEach((t=>{t.checked=!0})))}getSelectedRows(){return this.datatable.rows(".selected")}_getDatatable(t){const e=t.getAttribute("data-datatable");return jQuery(e).DataTable()}_onSearchKeyup(t){this._getDatatable(t.currentTarget).search(t.currentTarget.value).draw();const e=t.currentTarget.closest("div").querySelector(".search-magnifier-icon"),l=t.currentTarget.closest("div").querySelector(".search-delete-icon");""!==t.currentTarget.value?(l.classList.remove("d-none"),e.classList.add("d-none")):(l.classList.add("d-none"),e.classList.remove("d-none")),this.unCheckAllRows(),this.controlCheckAll()}_onSearchDelete(t){const e=t.currentTarget.closest("div"),l=e.querySelector(".search-magnifier-icon"),a=e.querySelector(".search-delete-icon");e.querySelector("input").value="",this._getDatatable(e.querySelector("input")).search("").draw(),a.classList.add("d-none"),l.classList.remove("d-none"),this.unCheckAllRows(),this.controlCheckAll()}_onPrintClick(t){t.preventDefault();try{this._getDatatable(t.currentTarget).buttons(3).trigger()}catch(t){console.log("Trigger button is not found")}}_onExportClick(t){t.preventDefault();t.currentTarget.closest(".datatable-export").getAttribute("data-datatable");if(t.currentTarget.classList.contains("export-copy"))try{this._getDatatable(t.currentTarget.closest(".datatable-export")).buttons(0).trigger()}catch(t){console.log("Trigger button is not found")}if(t.currentTarget.classList.contains("export-excel"))try{this._getDatatable(t.currentTarget.closest(".datatable-export")).buttons(1).trigger()}catch(t){console.log("Trigger button is not found")}if(t.currentTarget.classList.contains("export-cvs"))try{this._getDatatable(t.currentTarget.closest(".datatable-export")).buttons(2).trigger()}catch(t){console.log("Trigger button is not found")}}_onLengthClick(t){t.preventDefault();const e=parseInt(t.currentTarget.innerHTML);this._getDatatable(t.currentTarget.closest(".datatable-length")).page.len(e).draw(),this.unCheckAllRows(),this.controlCheckAll(),this.settings.lengthChangeCallback&&this.settings.lengthChangeCallback()}}